<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CHO INDEXING FORM</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h2>CHO INDEXING DATA COLLECTION</h2>

<form id="indexForm">

  <!-- PERSONAL INFORMATION -->
  <input name="surname" placeholder="SURNAME" required>
  <input name="firstname" placeholder="FIRSTNAME" required>
  <input name="othernames" placeholder="OTHERNAMES">

  <label for="passport">PASSPORT</label>
  <input type="file" id="passport" accept="image/*" required>

  <input name="cadre" value="CHO" readonly>

  <select name="gender" required>
    <option value="">SELECT GENDER</option>
    <option value="MALE">MALE</option>
    <option value="FEMALE">FEMALE</option>
  </select>

  <input name="bloodgroup" placeholder="BLOOD GROUP">
  <input name="state" placeholder="STATE">
  <input name="lga" placeholder="LGA / CITY/TOWN">

  <!-- ✅ Corrected DATE OF BIRTH -->
  <label for="dob">DATE OF BIRTH</label>
  <input type="date" id="dob" name="dob" required>

  <!-- O'LEVEL -->
  <select name="olevel_type" required>
    <option value="">SELECT O-LEVEL TYPE</option>
    <option value="WAEC">WAEC (Single Sitting)</option>
    <option value="NECO">NECO (Single Sitting)</option>
    <option value="WAEC / WAEC">WAEC / WAEC (Two Sittings)</option>
    <option value="NECO / NECO">NECO / NECO (Two Sittings)</option>
    <option value="NECO / WAEC">NECO / WAEC (Combined)</option>
  </select>
  <input name="olevel_year" placeholder="O-LEVEL YEAR(S)">
  <input name="olevel_exam" placeholder="O-LEVEL EXAM NUMBER">

  <!-- A'LEVEL / PROFESSIONAL -->
  <input name="alevel_type" placeholder="A-LEVEL TYPE">
  <input name="alevel_year" placeholder="A-LEVEL YEAR">
  <input name="pro_cert" placeholder="PROFESSIONAL CERTIFICATE NUMBER">

  <!-- SUBJECTS & GRADES -->
  <label>ENGLISH</label>
  <input id="engGrade" placeholder="GRADE" required>
  <select id="engBody">
    <option value="WAEC">WAEC</option>
    <option value="NECO">NECO</option>
  </select>

  <label>MATHEMATICS</label>
  <input id="mathGrade" placeholder="GRADE" required>
  <select id="mathBody">
    <option value="WAEC">WAEC</option>
    <option value="NECO">NECO</option>
  </select>

  <label>BIOLOGY / HEALTH SCIENCE</label>
  <input id="bioGrade" placeholder="GRADE">
  <select id="bioBody">
    <option value="WAEC">WAEC</option>
    <option value="NECO">NECO</option>
  </select>

  <label>CHEMISTRY</label>
  <input id="chemGrade" placeholder="GRADE">
  <select id="chemBody">
    <option value="WAEC">WAEC</option>
    <option value="NECO">NECO</option>
  </select>

  <label>PHYSICS</label>
  <input id="phyGrade" placeholder="GRADE">
  <select id="phyBody">
    <option value="WAEC">WAEC</option>
    <option value="NECO">NECO</option>
  </select>

  <!-- HIDDEN FIELDS FOR COMBINED GRADE + BOARD -->
  <input type="hidden" name="english">
  <input type="hidden" name="maths">
  <input type="hidden" name="biology">
  <input type="hidden" name="chemistry">
  <input type="hidden" name="physics">

  <input name="remarks" placeholder="REMARKS">
  <br><br>
  <button type="submit">SUBMIT</button>
</form>

<script>
const SHEETBEST_URL = "https://api.sheetbest.com/sheets/c610f771-67a2-4120-b4fa-c2d102aee546";
const CLOUDINARY_URL = "https://api.cloudinary.com/v1_1/<YOUR_CLOUD_NAME>/upload";
const CLOUDINARY_PRESET = "<YOUR_UPLOAD_PRESET>";

document.getElementById("indexForm").addEventListener("submit", async function(e) {
  e.preventDefault();
  const form = e.target;

  // 1️⃣ Upload passport to Cloudinary
  const passportFile = document.getElementById("passport").files[0];
  if (!passportFile) return alert("Please select a passport image.");

  const cloudForm = new FormData();
  cloudForm.append("file", passportFile);
  cloudForm.append("upload_preset", CLOUDINARY_PRESET);

  let passportUrl = "";
  try {
    const cloudRes = await fetch(CLOUDINARY_URL, { method: "POST", body: cloudForm });
    const cloudData = await cloudRes.json();
    passportUrl = cloudData.secure_url;
  } catch (err) {
    return alert("Passport upload failed.");
  }

  // 2️⃣ Combine grades + board
  const subjects = ["english","maths","biology","chemistry","physics"];
  subjects.forEach(subj => {
    const grade = document.getElementById(subj.slice(0,3) + "Grade").value;
    const board = document.getElementById(subj.slice(0,3) + "Body").value;
    form.querySelector('input[name="'+subj+'"]').value = `${grade} (${board})`;
  });

  // 3️⃣ Collect remaining form data
  const data = {
    SURNAME: form.surname.value.toUpperCase(),
    FIRSTNAME: form.firstname.value.toUpperCase(),
    OTHERNAMES: form.othernames.value.toUpperCase(),
    PASSPORT: passportUrl,
    CADRE: form.cadre.value,
    GENDER: form.gender.value,
    BLOOD_GROUP: form.bloodgroup.value,
    STATE: form.state.value,
    LGA_CITY_TOWN: form.lga.value,
    DATE_OF_BIRTH: form.dob.value,
    OLEVEL_TYPE: form.olevel_type.value,
    OLEVEL_YEAR: form.olevel_year.value,
    OLEVEL_EXAM_NUMBER: form.olevel_exam.value,
    ALEVEL_TYPE: form.alevel_type.value,
    ALEVEL_YEAR: form.alevel_year.value,
    PROFESSIONAL_CERTIFICATE_NUMBER: form.pro_cert.value,
    ENGLISH: form.querySelector('input[name="english"]').value,
    MATHEMATICS: form.querySelector('input[name="maths"]').value,
    BIOLOGY_HEALTH_SCIENCE: form.querySelector('input[name="biology"]').value,
    CHEMISTRY: form.querySelector('input[name="chemistry"]').value,
    PHYSICS: form.querySelector('input[name="physics"]').value,
    REMARKS: form.remarks.value
  };

  // 4️⃣ Send to SheetBest
  try {
    const res = await fetch(SHEETBEST_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    await res.json();
    alert("Submission successful!");
    form.reset();
  } catch(err) {
    alert("Submission failed. Please try again.");
    console.error(err);
  }
});
</script>

</body>
</html>