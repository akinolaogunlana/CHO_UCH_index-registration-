<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CHO INDEXING FORM</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h2>CHO INDEXING DATA COLLECTION</h2>

<form id="indexForm" enctype="multipart/form-data">

  <input name="surname" placeholder="SURNAME" required>
  <input name="firstname" placeholder="FIRSTNAME" required>
  <input name="othernames" placeholder="OTHERNAMES">

  <label>PASSPORT (JPG / PNG, Max 5MB)</label>
  <input type="file" id="passport" accept="image/jpeg,image/png" required>

  <input name="cadre" value="CHO" readonly>

  <select name="gender" required>
    <option value="">SELECT GENDER</option>
    <option value="MALE">MALE</option>
    <option value="FEMALE">FEMALE</option>
  </select>

  <input name="bloodgroup" placeholder="BLOOD GROUP">
  <input name="state" placeholder="STATE">
  <input name="lga" placeholder="LGA / CITY/TOWN">

  <label>DATE OF BIRTH</label>
  <input type="date" name="dob" required>

  <select name="olevel_type" required>
    <option value="">SELECT O-LEVEL TYPE</option>
    <option value="WAEC">WAEC</option>
    <option value="NECO">NECO</option>
    <option value="WAEC / WAEC">WAEC / WAEC</option>
    <option value="NECO / NECO">NECO / NECO</option>
    <option value="NECO / WAEC">NECO / WAEC</option>
  </select>

  <input name="olevel_year" placeholder="O-LEVEL YEAR(S)">
  <input name="olevel_exam" placeholder="O-LEVEL EXAM NUMBER">

  <input name="alevel_type" placeholder="A-LEVEL TYPE">
  <input name="alevel_year" placeholder="A-LEVEL YEAR">
  <input name="pro_cert" placeholder="PROFESSIONAL CERTIFICATE NUMBER">

  <input id="engGrade" placeholder="ENGLISH GRADE" required>
  <select id="engBody"><option>WAEC</option><option>NECO</option></select>

  <input id="mathGrade" placeholder="MATHEMATICS GRADE" required>
  <select id="mathBody"><option>WAEC</option><option>NECO</option></select>

  <input id="bioGrade" placeholder="BIOLOGY GRADE">
  <select id="bioBody"><option>WAEC</option><option>NECO</option></select>

  <input id="chemGrade" placeholder="CHEMISTRY GRADE">
  <select id="chemBody"><option>WAEC</option><option>NECO</option></select>

  <input id="phyGrade" placeholder="PHYSICS GRADE">
  <select id="phyBody"><option>WAEC</option><option>NECO</option></select>

  <input name="remarks" placeholder="REMARKS">

  <button type="submit">SUBMIT</button>
</form>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const SHEETBEST_URL = "https://api.sheetbest.com/sheets/c610f771-67a2-4120-b4fa-c2d102aee546";
  const CLOUDINARY_URL = "https://api.cloudinary.com/v1_1/dpsbwjw83/image/upload";
  const CLOUDINARY_PRESET = "cho_passports";

  const form = document.getElementById("indexForm");
  const btn = form.querySelector("button");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    btn.disabled = true;
    btn.innerText = "Uploading...";

    try {
      const file = passport.files[0];
      if (!file) throw "Passport required";

      if (file.size > 5 * 1024 * 1024) {
        throw "Image too large. Use photo under 5MB.";
      }

      const cloudForm = new FormData();
      cloudForm.append("file", file);
      cloudForm.append("upload_preset", CLOUDINARY_PRESET);

      const cloudRes = await fetch(CLOUDINARY_URL, {
        method: "POST",
        body: cloudForm
      });

      if (!cloudRes.ok) throw "Cloudinary upload failed";

      const cloudData = await cloudRes.json();
      if (!cloudData.secure_url) throw "Upload error";

      btn.innerText = "Saving data...";

      const data = {
        SURNAME: form.surname.value.toUpperCase(),
        FIRSTNAME: form.firstname.value.toUpperCase(),
        OTHERNAMES: form.othernames.value.toUpperCase(),
        PASSPORT: cloudData.secure_url,
        CADRE: form.cadre.value,
        GENDER: form.gender.value,
        BLOOD_GROUP: form.bloodgroup.value,
        STATE: form.state.value,
        LGA_CITY_TOWN: form.lga.value,
        DATE_OF_BIRTH: form.dob.value,
        OLEVEL_TYPE: form.olevel_type.value,
        OLEVEL_YEAR: form.olevel_year.value,
        OLEVEL_EXAM_NUMBER: form.olevel_exam.value,
        ALEVEL_TYPE: form.alevel_type.value,
        ALEVEL_YEAR: form.alevel_year.value,
        PROFESSIONAL_CERTIFICATE_NUMBER: form.pro_cert.value,
        REMARKS: form.remarks.value,
        ENGLISH: `${engGrade.value} (${engBody.value})`,
        MATHEMATICS: `${mathGrade.value} (${mathBody.value})`,
        BIOLOGY: bioGrade.value ? `${bioGrade.value} (${bioBody.value})` : "",
        CHEMISTRY: chemGrade.value ? `${chemGrade.value} (${chemBody.value})` : "",
        PHYSICS: phyGrade.value ? `${phyGrade.value} (${phyBody.value})` : ""
      };

      const res = await fetch(SHEETBEST_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
      });

      if (!res.ok) throw "Sheet save failed";

      form.innerHTML = `
        <div style="text-align:center;padding:40px">
          <h2 style="color:green">âœ… Submission Successful</h2>
          <p>Your information has been saved.</p>
          <button onclick="location.reload()">Submit Another</button>
        </div>
      `;

    } catch (err) {
      alert(err);
      btn.disabled = false;
      btn.innerText = "SUBMIT";
      console.error(err);
    }
  });
});
</script>

</body>
</html>